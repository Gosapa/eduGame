{% extends 'base.html' %}
{% block body %}
<div class="container mx-auto flex flex-col items-center justify-center min-h-96 p-4">
    <div class="flex flex-col items-center text-center my-16">
        
        <img src="{{ user.socialaccount_set.all.0.extra_data.picture }}" class="rounded-full w-32 h-32 mb-4" alt="Profile Picture">
        
        <h1 class="text-7xl text-gray-800">{{ user.first_name }} {{ user.last_name }}</h1>
    </div>
    <div class="flex flex-col md:flex-row items-center justify-center space-x-8 md:space-x-16">
        <div class="flex flex-col items-start justify-start space-y-4">
            <h2 class="text-xl font-bold text-gray-800">Game Statistics</h2>
            <div class="border rounded-md p-4 shadow-md overflow-y-auto h-96">
                <p class="text-gray-700">Games Completed: {{profile.games_completed}}</p>
                <p class="text-gray-700">Subjects Completed:</p>
                <ul class="list-disc pl-6">
                    {% for subject, cnt in profile.subjects_completed.items %}
                        <li class="text-gray-700">{{subject}}: {{cnt}}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="flex flex-col items-start justify-start space-y-4 w-1/3">
            <h2 class="text-xl font-bold text-gray-800">Achievements</h2>
            <div class="border rounded-md p-4 shadow-md overflow-y-auto h-96">
                <ul class="list-disc pl-6">
                    {% for achievement in achievements %}
                        <li class="text-gray-700 flex items-center"> 
                            <div class="flex flex-col"> 
                            <span class="font-bold text-indigo-600">{{ achievement.name }}</span>
                            <p class="text-sm text-gray-600">{{ achievement.description }}</p>  
                            </div>
                            <button 
                                class="ml-4 bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded-md focus:outline-none focus:shadow-outline text-xs"
                                data-achievement-id="{{ achievement.id }}"
                                onclick="deleteAchievement(this)"
                            >
                                Delete
                            </button>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock body %}
{% block script %}
<script>
    async function deleteAchievement(button) {
        const achievementId = button.dataset.achievementId;
        const endpointURL = `{% url 'users:delete_achievement' %}?achievement_id=${achievementId}`; 

        if (confirm("Are you sure you want to delete this achievement? You can't revert this action.")) {
            try {
                const response = await fetch(endpointURL, {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": "{{ csrf_token }}",
                    },
                });
                if (response.ok) {
                    button.closest("li").remove();
                    location.reload()
                } else {
                    console.error("Error deleting achievement:", response.status);
                    console.log(response);
                }
            } catch (error) {
                console.error("Error occurred:", error);
            }
        }
    }
</script>
{% endblock script %}